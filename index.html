<script>
document.addEventListener("DOMContentLoaded", () => {

    /* ----------------------------
       ‚≠ê ALL YOUR TRANSLATIONS HERE
       (KEEP YOUR ORIGINAL TRANSLATIONS)
    ----------------------------- */
    const translations = { ...YOUR_LANGUAGE_DATA... };


    let currentLang = "en";

    /* ----------------------------
       LANGUAGE SWITCHER
    ----------------------------- */
    window.changeLanguage = function () {
        currentLang = document.getElementById("langSelect").value;
        const L = translations[currentLang];

        document.getElementById("pageTitle").textContent = L.pageTitle;
        document.getElementById("mainTitle").textContent = L.mainTitle;
        document.getElementById("description").textContent = L.description;
        document.getElementById("topicInput").placeholder = L.placeholder;
        document.getElementById("generateBtn").textContent = L.button;
        document.getElementById("resetBtn").textContent = L.reset;

        const RTL = currentLang === "ar";
        document.documentElement.dir = RTL ? "rtl" : "ltr";
        document.body.style.direction = RTL ? "rtl" : "ltr";
    };


    /* ----------------------------
       RESET FORM
    ----------------------------- */
    window.resetForm = function () {
        document.getElementById("topicInput").value = "";
        document.getElementById("titles").innerHTML = "";
    };


    /* ----------------------------
       COPY TO CLIPBOARD
    ----------------------------- */
    window.copyToClipboard = function (text, btn) {
        navigator.clipboard.writeText(text).then(() => {
            const old = btn.textContent;
            btn.textContent = "‚úì";
            setTimeout(() => btn.textContent = old, 800);
        });
    };


    /* ----------------------------
       ‚≠ê MAIN TITLE GENERATION FIXED ‚≠ê
    ----------------------------- */
    window.generateTitles = function () {

        const topicInput = document.getElementById("topicInput");
        const topic = topicInput.value.trim();
        const L = translations[currentLang];

        if (!topic) {
            alert(L.alert);
            topicInput.classList.add("error");
            setTimeout(() => topicInput.classList.remove("error"), 500);
            return;
        }

        const titlesDiv = document.getElementById("titles");
        titlesDiv.innerHTML = "";

        const langTopics = L.topics;
        const englishKeys = Object.keys(translations.en.topics);
        const topicUpper = topic.toUpperCase();

        // AUTO-DETECTION (cook, fitness, beauty, etc)
        let chosenTopic = langTopics.DEFAULT;

        for (const key of englishKeys) {
            if (topicUpper.includes(key)) {
                chosenTopic = langTopics[key];
                break;
            }
        }

        const templates = chosenTopic.templates;
        const emoji = chosenTopic.emoji;

        const used = new Set();

        while (used.size < 10) {
            const temp = templates[Math.floor(Math.random() * templates.length)];
            const finalText = (emoji + " " + temp.replace("[KEYWORD]", topic.trim())).trim();
            used.add(finalText);
        }

        // Display titles
        used.forEach(title => {
            const box = document.createElement("div");
            box.className = "title-container";

            box.innerHTML = `
                <span class="title-text">${title}</span>
                <button class="copy-btn" onclick="copyToClipboard('${title.replace(/'/g, "\\'")}', this)">üìã</button>
            `;

            titlesDiv.appendChild(box);
        });
    };


    /* ----------------------------
       ‚≠ê CONNECT BUTTON (IMPORTANT FIX)
    ----------------------------- */
    document.getElementById("generateBtn").addEventListener("click", generateTitles);

});
</script>
